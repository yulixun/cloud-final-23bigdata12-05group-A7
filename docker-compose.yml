version: '3.8'  # Compose 版本

services:
  mysql-db:  # 服务名
    image: mysql:8.0  # 稳定版 MySQL 镜像
    container_name: mysql-task7  # 容器名，方便识别
    restart: always  # 容器异常时自动重启
    environment:
      MYSQL_ROOT_PASSWORD: osos1887  # root 密码
      MYSQL_DATABASE: task7_db     # 初始化创建的数据库
      MYSQL_USER: task7_user       # 自定义用户
      MYSQL_PASSWORD: task7_pass   # 自定义用户密码
    ports:
      - "3307:3306"  # 端口映射（主机3307容器端口3306，Windows 可访问）
    volumes:
      # 挂载自定义配置文件到容器内
      - ./src/db/my.cnf:/etc/mysql/conf.d/my.cnf
      # 挂载数据目录到宿主机（实现持久化，对应 volumes/mysql）
      - ./volumes/mysql:/var/lib/mysql
    healthcheck:  # 健康检查
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-u", "root", "-p123456"]
      interval: 10s  # 每10秒检查一次
      timeout: 5s    # 检查超时时间
      retries: 3     # 失败3次判定为不健康
      start_period: 30s  # 容器启动后30秒再开始检查（避免启动中误判）
    networks:
      - task7-network

# 自定义网络（隔离容器，规范做法）
networks:
  task7-network:
    driver: bridge
